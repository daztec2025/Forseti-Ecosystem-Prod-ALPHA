# Dockerfile to test deployment matching Azure App Service environment
# Azure App Service uses: NODE|22-lts on Linux (Ubuntu-based)

FROM node:22-slim

# Set working directory to match Azure's wwwroot
WORKDIR /home/site/wwwroot

# Copy the standalone build output (simulating what the pipeline deploys)
# The standalone output has apps/web/server.js due to outputFileTracingRoot
COPY .next/standalone/ .

# Copy static files to the correct location
COPY .next/static/ ./apps/web/.next/static/

# Copy public files
COPY public/ ./apps/web/public/

# Azure App Service exposes port 8080 by default
ENV PORT=8080
ENV NODE_ENV=production

# Expose the port
EXPOSE 8080

# Start command matching Azure's startup command: node server.js
# But since outputFileTracingRoot puts it at apps/web/server.js
WORKDIR /home/site/wwwroot/apps/web
CMD ["node", "server.js"]
